---

---

<button id="theme-toggle" aria-label="テーマの切り替え">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="currentColor"
  >
    <path
      class="sun"
      fill-rule="evenodd"
      d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
      clip-rule="evenodd"
    />
    <path
      class="moon"
      d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
    />
  </svg>
</button>

<style>
  #theme-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    background-color: rgba(255, 255, 255, 0.8);
    color: var(--accent-blue);
    padding: 12px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    border: none;
    outline: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(5px);
  }

  .dark #theme-toggle {
    background-color: rgba(31, 41, 55, 0.8);
    color: white;
  }

  #theme-toggle:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  }

  #theme-toggle:active {
    transform: translateY(0) scale(0.98);
  }
  
  .sun {
    fill: transparent;
    transition: fill 0.3s ease;
  }
  
  .moon {
    fill: transparent;
    transition: fill 0.3s ease;
  }

  :global(.dark) .sun {
    fill: transparent;
  }
  
  :global(.dark) .moon {
    fill: white;
  }
  
  @media (prefers-reduced-motion: no-preference) {
    #theme-toggle {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(var(--accent-blue-rgb, 59, 130, 246), 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(var(--accent-blue-rgb, 59, 130, 246), 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(var(--accent-blue-rgb, 59, 130, 246), 0);
      }
    }
  }
  
  @media (max-width: 768px) {
    #theme-toggle {
      bottom: 15px;
      right: 15px;
      width: 40px;
      height: 40px;
      padding: 10px;
    }
  }
</style>

<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme") || "light"; // nullの場合は light を返す
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
    const sunElement = document.querySelector('.sun');
    const moonElement = document.querySelector('.moon');
    if (sunElement) sunElement.setAttribute('fill', 'currentColor');
    if (moonElement) moonElement.setAttribute('fill', 'transparent');
  } else {
    document.documentElement.classList.add("dark");
    const sunElement = document.querySelector('.sun');
    const moonElement = document.querySelector('.moon');
    if (moonElement) moonElement.setAttribute('fill', 'currentColor');
    if (sunElement) sunElement.setAttribute('fill', 'transparent');
  }

  // themeがnull似なる可能性をなくす
  window.localStorage.setItem("theme", theme || "light");

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
    
    const sunElement = document.querySelector('.sun');
    const moonElement = document.querySelector('.moon');
    
    if (isDark) {
      if (moonElement) moonElement.setAttribute('fill', 'currentColor');
      if (sunElement) sunElement.setAttribute('fill', 'transparent');
    } else {
      if (sunElement) sunElement.setAttribute('fill', 'currentColor');
      if (moonElement) moonElement.setAttribute('fill', 'transparent');
    }
  };

  const toggleButton = document.getElementById("theme-toggle");

  // toggleButtonがnullでないことを確認
  if (toggleButton) {
    toggleButton.addEventListener("click", handleToggleClick);
  }
</script>
